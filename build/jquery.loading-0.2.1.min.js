/**
 * jQuery Loading Plugin - Shows loading progress animation, flexible and pretty =).
 *
 * Version: 0.2.1
 *
 * Copyright 2013, Sergey Kamardin.
 *
 * Licensed under the MIT license.
 * http://www.opensource.org/licenses/mit-license.php
 *
 * Date: 2013-04-02 00:00:34
 * Location: Moscow, Russia.
 * Contact: gobwas@gmail.com
 */


(function(t){var i=function(){var n=function(){var t="abcdefghijklmnopqrstuvwxyz0123456789",i=50;return function(n){var r,o,e=t.length-1,a="";n||(n=i);for(var s=0;n>s;s++)o=parseInt(Math.floor(Math.random()*(e+1))),r=t.charAt(o),Math.floor(2*Math.random())&&(r=r.toUpperCase()),a+=r;return a}}(),r=function(t){if("function"==typeof t)return t;if(i.algorithm.hasOwnProperty(t))return i.algorithm[t];throw Error('Algorithm not found: "'+t+'"')},o=function(t){if("function"==typeof t)return t;if(t instanceof Array){for(var n,r=t.length-1;r>=0;r--)n=function(t,i,n){return function(){t.apply(null,arguments),n&&n.apply(null,arguments)}}(o(t[r]),r,n);return n.count=t.length,n}if(i.effect.hasOwnProperty(t)){var e=i.effect[t];return e.count=1,e}throw Error('Effect not found: "'+t+'"')},e=function(i){var n=i.spinner,r=i.spinner.matrix,o=i.spinner.pin,e=t.extend({},i);if(r.x&&r.y?(e.spinner.pin.width=Math.floor((n.width-(o.margin.right+o.margin.left)*r.x)/r.x),e.spinner.pin.height=Math.floor((n.height-(o.margin.top+o.margin.bottom)*r.y)/r.y)):(e.spinner.matrix.x=Math.floor(n.width/(o.width+o.margin.left+o.margin.right)),e.spinner.matrix.y=Math.floor(n.height/(o.height+o.margin.top+o.margin.bottom))),e.spinner.matrix.x-=1,e.spinner.matrix.y-=1,0>=e.spinner.pin.width||0>=e.spinner.pin.height)throw Error("There is not enough space for spinner.");return e},a=function(i,n){var r=t("<div/>"),o={position:"absolute"};return t.extend(o,n),o.background=i.img?i.color+" url("+i.img+") "+i.position:i.color,i.borderRadius&&(o["border-radius"]=i.borderRadius),r.css(o),r},s=function(i,n){var r=t("<div/>");return r.css({position:"absolute",width:i.width,height:i.height,top:n.y*(i.height+i.margin.top+i.margin.bottom),left:n.x*(i.width+i.margin.left+i.margin.right)}).attr({"class":"loading-pin"}),r},h=function(t){for(var i=[],n=0;t.matrix.x>=n;n++){i[n]||(i[n]=[]);for(var r=0;t.matrix.y>=r;r++)i[n][r]=s(t.pin,{x:n,y:r})}return i},f=function(i,n,r){var o=t("<div/>");o.css({position:"absolute",left:(n.width-i.width)/2,top:(n.height-i.height)/2,width:i.width,height:i.height});for(var e=0;r.length>e;e++)for(var a=0;r[e].length>a;a++)o.append(r[e][a]);return o};return function(i,s){s||(s={}),this.target=i,this.id=n(50),this.options=e(t.extend({},t.fn.loading.defaults,s,!0)),this.dimensions={top:this.target.offset().top,left:this.target.offset().left,width:this.target.outerWidth(),height:this.target.outerHeight()},this.pins=h(this.options.spinner),this.background=a(this.options.background,this.dimensions),this.spinner=f(this.options.spinner,this.dimensions,this.pins),this.algorithm=r(this.options.algorithm),this.effect=o(this.options.effect),this.counter=0,this.initialize(s)}}();i.prototype={constructor:i,initialize:function(t){t||(t={}),t.progress&&(this.progress=t.progress)},show:function(){this.background.append(this.spinner).appendTo(this.target)},start:function(){var t={x:this.options.spinner.matrix.x,y:this.options.spinner.matrix.y},i=Math.max(this.options.spinner.interval/this.effect.count,0),n=this.pins,r=null,o=this.algorithm,e=this.effect,a=this;this.interval=setInterval(function(){r=o(t,r),e(n[r.x][r.y],i),a.counter++,a.progress>=100&&a.stop()},i)},stop:function(){clearInterval(this.interval)}},i.algorithm={},i.effect={},t.fn.loading=function(t){if(this.data("loading")){var n=this.data("loading");n.initialize(t)}else{var n=new i(this,t);this.data({loading:n}),n.show(),n.start()}},t.fn.loading.algorithm=function(t,n){i.algorithm[t]=n},t.fn.loading.effect=function(t,n){i.effect[t]=n}})(jQuery),function(t){t.fn.loading.defaults={opacity:.9,speedIn:300,speedOut:1e3,progress:0,algorithm:"snake",effect:["simple"],spinner:{width:35,height:35,matrix:{x:null,y:null},pin:{width:7,height:7,margin:{top:1,right:1,bottom:0,left:0}},interval:100},background:{color:"white",position:"",img:null,borderRadius:1}}}(jQuery),function(t){t.fn.loading.algorithm("linear",function(){})}.call(this,jQuery),function(t){t.fn.loading.algorithm("random",function(){})}.call(this,jQuery),function(t){t.fn.loading.algorithm("snake",function(){var t=function(t){return"x"==t?"y":"x"},i=function(t,i,n){var r=!0;return r=r&&t>=n.matrix.x[0]&&n.matrix.x[1]>=t,r=r&&i>=n.matrix.y[0]&&n.matrix.y[1]>=i},n=function(i,n,r,o){this.x=i.x,this.y=i.y,this.axis=n?t(i.axis):i.axis,this.sign=r?-1*i.sign:i.sign,o||(this[this.axis]+=this.sign)},r=[function(t){var r=new n(t,!1,!1);return i(r.x,r.y,t)?r:!1},function(t){var r=new n(t,!0,!0);return i(r.x,r.y,t)?r:!1},function(t){var r=new n(t,!0,!1);return i(r.x,r.y,t)?r:!1},function(t){var r=new n(t,!1,!0,!0);return i(r.x,r.y,t)?r:!1}],o=function(t){for(var i,o=0;r.length>o;o++)if(i=r[o](t),i instanceof n)return i;return!1},e=function(t,i){var n=[t.matrix.x[0]-i,t.matrix.x[1]+i],r=[t.matrix.y[0]-i,t.matrix.y[1]+i];return n[0]>=0&&n[0]<=n[1]&&r[0]>=0&&r[0]<=r[1]?(t.matrix.x=n,t.matrix.y=r,!0):!1},a=function(t){var i,n=t.matrix.x[1]-t.matrix.x[0],r=t.matrix.y[1]-t.matrix.y[0];return 0==n&&0==r?1:i=0==n?r+1:0==r?n+1:2*(n+r)},s=function(t){t.sign*=-1,t.reversed*=-1},h=function(t){var i={x:0,y:0,axis:"x",sign:1,matrix:{x:[0,t.x],y:[0,t.y]},path:0,reversed:-1};return i.fullPath=a(i),i};return function(t,i){if(!i)return i=h(t),i.path++,i;if(i.path==i.fullPath){if(!e(i,i.reversed))return s(i),i.path=0,i.path++,i;i.path=0,i.fullPath=a(i)}var n=o(i);if(n)return i.x=n.x,i.y=n.y,i.axis=n.axis,i.sign=n.sign,i.path++,i;throw Error("Cant resolve path")}}())}.call(this,jQuery),function(t){t.fn.loading.effect("fancy",function(t,i){t.css({background:"#"+(0|(1<<24)*Math.random()).toString(16)}).animate({width:"-=2",height:"-=2",top:"+=1",left:"+=1"},i/2).animate({width:"+=2",height:"+=2",top:"-=1",left:"-=1"},i/2)})}.call(this,jQuery),function(t){t.fn.loading.effect("jump",function(t,i){var n=Math.floor(7*Math.random()+1);t.animate({top:"-="+n},2*(i/3)).animate({top:"+="+n},i/3)})}.call(this,jQuery),function(t){t.fn.loading.effect("simple",function(t,i){t.data("simple-init")||t.css({background:"green",opacity:0}).data("simple-init",!0),t.data("simple-sign",t.data("simple-sign")?!1:!0).animate({opacity:t.data("simple-sign")?1:0},i)})}.call(this,jQuery);